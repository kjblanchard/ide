-- ===========================
--   Minimal Neovim Config
--   1:1 port of your Vimrc
--   No extras, no fluff
-- ===========================

-- General settings
vim.o.number = true
vim.o.cursorline = true
vim.o.termguicolors = true
vim.o.splitright = true
vim.o.splitbelow = true
vim.o.hidden = true
vim.o.updatetime = 300
vim.o.signcolumn = "yes"
vim.o.cmdheight = 2
vim.o.tabstop = 4
vim.o.shiftwidth = 4
vim.o.expandtab = true
vim.o.ignorecase = true
vim.o.smartcase = true
vim.o.incsearch = true
vim.o.hlsearch = true
vim.o.wildmenu = true
vim.o.wildignore = "*.o,*.obj,*.exe,*.so,*.dll,*.pyc,*/node_modules/*"
vim.o.foldmethod = "indent"
vim.o.foldlevel = 0
vim.g.mapleader = " "

vim.opt.rtp:prepend("~/.local/share/nvim/lazy/lazy.nvim")


-- Match your listchars
vim.o.listchars = "tab:▸▸,trail:•,extends:>,precedes:<"

-- YAML indentation fix
vim.api.nvim_create_autocmd("FileType", {
  pattern = "yaml",
  command = "setlocal ts=2 sts=2 sw=2 expandtab",
})

-- Zoom toggle (ported from your Vimscript)
_G.utils = {}
function _G.utils.zoom_toggle()
  if vim.t.zoomed then
    vim.cmd(vim.t.zoom_winrestcmd)
    vim.t.zoomed = false
  else
    vim.t.zoom_winrestcmd = vim.fn.winrestcmd()
    vim.cmd("resize")
    vim.cmd("vertical resize")
    vim.t.zoomed = true
  end
end

-- Keymaps (ported exactly)
local map = vim.keymap.set
map("n", "<leader>z", ":lua require('utils').zoom_toggle()<CR>")
map("n", "<leader>t", ":tabnew<CR>")
map("n", "<leader>'", ":vsplit<CR>")
map("n", "<leader>5", ":split<CR>")
map("n", "<F2>", ":lua vim.lsp.buf.rename()<CR>")
map("n", "<F12>", ":lua vim.lsp.buf.definition()<CR>")
map("n", "<leader>d", ":lua vim.lsp.buf.declaration()<CR>")
map("n", "<leader>k", ":lua vim.lsp.buf.hover()<CR>")
map("n", "<leader>f", ":lua vim.lsp.buf.format()<CR>")

-- ===========================
-- Plugin Setup (lazy.nvim)
-- ===========================
require("lazy").setup({

  -- LSP installer
  { "williamboman/mason.nvim", config = true },
  { "williamboman/mason-lspconfig.nvim" },

  -- LSP config
  { "neovim/nvim-lspconfig" },

  -- Completion (minimal replacement for coc)
  {
    "hrsh7th/nvim-cmp",
    dependencies = {
      "hrsh7th/cmp-nvim-lsp",
    },
  },

  -- Colorscheme (you used molokai)
  { "tomasr/molokai" },
})

-- ===========================
-- LSP Setup
-- ===========================
require("mason").setup()
require("mason-lspconfig").setup({
  ensure_installed = {
    "clangd",
    "tsserver",
    "yamlls",
    "terraformls",
    "pyright",
  },
})

vim.lsp.config
local cmp = require("cmp")

-- Completion setup (simple)
cmp.setup({
  mapping = cmp.mapping.preset.insert({
    ["<Tab>"] = cmp.mapping.confirm({ select = true }),
  }),
  sources = {
    { name = "nvim_lsp" },
  },
})

local capabilities = require("cmp_nvim_lsp").default_capabilities()

-- Enable your LSPs
for _, server in ipairs({ "clangd", "tsserver", "yamlls", "terraformls", "pyright" }) do
  lspconfig[server].setup({
    capabilities = capabilities,
  })
end

-- Colorscheme
vim.cmd("colorscheme molokai")

